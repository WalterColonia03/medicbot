â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… MEJORAS IMPLEMENTADAS: ZONA HORARIA DE PERÃš
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA ANTERIOR:
------------------
âŒ El chatbot usaba hora del servidor (UTC o zona local)
âŒ PermitÃ­a seleccionar horarios pasados el mismo dÃ­a
âŒ No validaba si "Hoy" tenÃ­a horarios disponibles
âŒ El usuario podÃ­a reservar citas en horarios que ya pasaron


SOLUCIÃ“N IMPLEMENTADA:
----------------------
âœ… Zona horaria de PerÃº (UTC-5) sin horario de verano
âœ… Filtra automÃ¡ticamente horarios pasados
âœ… Oculta la opciÃ³n "Hoy" si no hay horarios disponibles
âœ… Solo muestra horarios futuros


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNCIONALIDADES NUEVAS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£ DETECCIÃ“N AUTOMÃTICA DE HORA ACTUAL EN PERÃš
   - Calcula la hora de PerÃº (UTC-5)
   - Compara con horarios disponibles
   - Filtra automÃ¡ticamente lo que ya pasÃ³

2ï¸âƒ£ VALIDACIÃ“N INTELIGENTE DE FECHAS
   Antes de mostrar opciones:
   âœ… Verifica si quedan horarios disponibles HOY
   âœ… Si NO hay horarios, oculta la opciÃ³n "Hoy"
   âœ… Muestra advertencia: "âš ï¸ No hay horarios disponibles para hoy"

3ï¸âƒ£ FILTRADO DINÃMICO DE HORARIOS
   Si selecciona "Hoy":
   âœ… Solo muestra horarios despuÃ©s de la hora actual
   âœ… Ejemplo: Si son las 14:30, solo muestra desde 15:00 en adelante
   
   Si selecciona "MaÃ±ana" o "Pasado maÃ±ana":
   âœ… Muestra todos los horarios disponibles


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EJEMPLOS DE USO:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESCENARIO 1: Usuario consulta a las 09:00 AM
---------------------------------------------
Bot muestra:
1. Hoy (06/11/2025)      âœ… Disponible
2. MaÃ±ana (07/11/2025)
3. Pasado maÃ±ana (08/11/2025)

Al seleccionar "Hoy", muestra:
1. 09:30 - 10:00  âœ…
2. 10:00 - 10:30  âœ…
3. 10:30 - 11:00  âœ…
... (horarios desde 09:30 en adelante)


ESCENARIO 2: Usuario consulta a las 16:45 PM
---------------------------------------------
Bot muestra:
1. MaÃ±ana (07/11/2025)
2. Pasado maÃ±ana (08/11/2025)

âš ï¸ No hay horarios disponibles para hoy.

(Oculta "Hoy" porque solo quedan 15 minutos hasta las 17:00)


ESCENARIO 3: Usuario consulta a las 14:00 PM
---------------------------------------------
Bot muestra:
1. Hoy (06/11/2025)      âœ… Disponible
2. MaÃ±ana (07/11/2025)
3. Pasado maÃ±ana (08/11/2025)

Al seleccionar "Hoy", muestra:
1. 14:30 - 15:00  âœ…
2. 15:00 - 15:30  âœ…
3. 15:30 - 16:00  âœ…
4. 16:00 - 16:30  âœ…
5. 16:30 - 17:00  âœ…

(Solo horarios despuÃ©s de las 14:00)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CÃ“DIGO IMPLEMENTADO:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Obtener hora actual de PerÃº
const peruNow = getPeruDateTime();
const currentTime = getCurrentPeruTime(); // Ej: "14:30"
const today = formatPeruDate(peruNow, 'yyyy-MM-dd');

// Verificar si hay horarios disponibles HOY despuÃ©s de ahora
const { data: todaySlots } = await supabaseServer
  .from('time_slots')
  .select('id')
  .eq('doctor_id', selectedDoctor.id)
  .eq('slot_date', today)
  .eq('is_available', true)
  .gt('start_time', currentTime)  // ğŸ”‘ CLAVE: Mayor que hora actual
  .limit(1);

// Si es HOY, filtrar horarios pasados
if (isToday) {
  query = query.gt('start_time', currentTimeForSlots);
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CÃ“MO PROBAR:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PRUEBA 1: Horarios disponibles hoy
-----------------------------------
1. EnvÃ­a "hola" al bot
2. Selecciona un doctor: "1"
3. Verifica que aparece "Hoy" si hay horarios disponibles
4. Selecciona "1" (Hoy)
5. Verifica que SOLO muestra horarios futuros


PRUEBA 2: Sin horarios disponibles hoy
---------------------------------------
1. Ejecuta esto en Supabase para simular:

   -- Hacer que TODOS los slots de hoy estÃ©n ocupados
   UPDATE time_slots 
   SET is_available = false 
   WHERE slot_date = CURRENT_DATE;

2. EnvÃ­a "hola" al bot
3. Selecciona un doctor: "1"
4. Verifica que NO aparece la opciÃ³n "Hoy"
5. Verifica el mensaje: "âš ï¸ No hay horarios disponibles para hoy"


PRUEBA 3: Simular diferentes horas del dÃ­a
-------------------------------------------
Para probar como si fuera otra hora, modifica temporalmente:

const PERU_UTC_OFFSET = -5;

Por ejemplo, para simular las 16:00:
1. Cambia a: const PERU_UTC_OFFSET = -9; (4 horas adelante)
2. Reinicia el servidor
3. Prueba el bot
4. Restaura a: const PERU_UTC_OFFSET = -5;


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESTAURAR SLOTS DE PRUEBA:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si desactivaste slots para probar, restaura con:

-- Reactivar todos los slots de hoy
UPDATE time_slots 
SET is_available = true 
WHERE slot_date = CURRENT_DATE
  AND NOT EXISTS (
    SELECT 1 FROM appointments 
    WHERE appointments.time_slot_id = time_slots.id
  );


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PRÃ“XIMOS PASOS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. âœ… Reiniciar el servidor: .\start-bot.bat
2. âœ… Probar el chatbot con diferentes escenarios
3. âœ… Verificar que solo muestra horarios futuros
4. âœ… Confirmar que funciona correctamente con zona horaria de PerÃº


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
NOTAS TÃ‰CNICAS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

- Zona horaria: UTC-5 (PerÃº no usa horario de verano)
- Formato de hora: 24 horas (HH:mm)
- ComparaciÃ³n: String comparison (funciona porque formato es HH:mm)
- Base de datos: Los time_slots usan TIME sin zona horaria
- ValidaciÃ³n: Se hace en el webhook antes de mostrar opciones


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
