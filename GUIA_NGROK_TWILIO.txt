â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ğŸš€ GUÃA COMPLETA: CONFIGURAR TWILIO + NGROK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA ACTUAL:
Twilio recibe tu "hola" pero no sabe quÃ© hacer con Ã©l porque
el webhook no estÃ¡ configurado.

SOLUCIÃ“N:
Configurar ngrok + Twilio para conectar WhatsApp con tu bot.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ PASO 1: INSTALAR NGROK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OpciÃ³n A: Con Chocolatey (Recomendado para Windows)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Abre PowerShell como Administrador
2. Ejecuta:
   choco install ngrok

OpciÃ³n B: Descarga Manual
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Ve a: https://ngrok.com/download
2. Descarga la versiÃ³n para Windows
3. Descomprime el archivo ngrok.exe
4. (Opcional) Mueve ngrok.exe a una carpeta en tu PATH


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”‘ PASO 2: CREAR CUENTA EN NGROK (GRATIS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Ve a: https://ngrok.com
2. Haz clic en "Sign up" (crear cuenta)
3. RegÃ­strate con Google o email
4. Verifica tu email

5. Ve a: https://dashboard.ngrok.com/get-started/your-authtoken
6. Copia tu "Authtoken" (se ve asÃ­: 2abc...xyz)

7. Abre terminal/PowerShell y ejecuta:
   ngrok config add-authtoken TU_TOKEN_AQUI

Ejemplo:
   ngrok config add-authtoken 2abcXYZ123_456defGHI789jklMNO


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ PASO 3: INICIAR TU SERVIDOR NEXT.JS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Abre terminal en la carpeta del proyecto:
   cd c:\Users\walte\CascadeProjects\windsurf-project\medicbot

2. Instala dependencias (si no lo has hecho):
   npm install

3. Inicia el servidor:
   npm run dev

4. Verifica que estÃ© corriendo en:
   http://localhost:3000

âš ï¸ DEJA ESTA TERMINAL ABIERTA


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸŒ PASO 4: EXPONER CON NGROK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Abre OTRA terminal/PowerShell (la del servidor queda corriendo)

2. Ejecuta:
   ngrok http 3000

3. VerÃ¡s algo como esto:

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Session Status    online                        â”‚
   â”‚ Account           tu-email@gmail.com            â”‚
   â”‚ Version           3.x.x                         â”‚
   â”‚ Region            United States (us)            â”‚
   â”‚ Forwarding        https://abcd-1234.ngrok.io -> â”‚
   â”‚                   http://localhost:3000         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. COPIA la URL que dice "Forwarding" (https://abcd-1234.ngrok.io)

âš ï¸ IMPORTANTE: 
   - Esta URL es PÃšBLICA
   - Cualquiera con ella puede acceder
   - CambiarÃ¡ cada vez que reinicies ngrok (en plan gratuito)
   - DEJA ESTA TERMINAL ABIERTA tambiÃ©n


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”— PASO 5: CONFIGURAR WEBHOOK EN TWILIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Ve a Twilio Console:
   https://console.twilio.com/us1/develop/sms/try-it-out/whatsapp-learn

2. Haz clic en "Sandbox Settings" (ConfiguraciÃ³n del Sandbox)
   O busca el menÃº: Messaging â†’ Try it out â†’ WhatsApp Sandbox

3. Busca la secciÃ³n "Sandbox Configuration"

4. En el campo "WHEN A MESSAGE COMES IN":
   
   Pega tu URL de ngrok + la ruta del webhook:
   https://abcd-1234.ngrok.io/api/webhook/twilio-supabase
   
   âš ï¸ IMPORTANTE: Reemplaza "abcd-1234" con tu URL real de ngrok
   âš ï¸ NO olvides agregar "/api/webhook/twilio-supabase" al final

5. MÃ©todo: AsegÃºrate que diga "HTTP POST"

6. Haz clic en "Save" (Guardar)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… PASO 6: VERIFICAR CONFIGURACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Verifica que tengas:

Terminal 1 (Servidor):
  npm run dev
  â†’ http://localhost:3000 corriendo âœ“

Terminal 2 (ngrok):
  ngrok http 3000
  â†’ https://abcd-1234.ngrok.io â†’ localhost:3000 âœ“

Twilio Webhook configurado:
  URL: https://abcd-1234.ngrok.io/api/webhook/twilio-supabase
  MÃ©todo: POST âœ“

Archivo .env:
  NEXT_PUBLIC_SUPABASE_URL=...
  NEXT_PUBLIC_SUPABASE_ANON_KEY=...
  SUPABASE_SERVICE_ROLE_KEY=...
  TWILIO_ACCOUNT_SID=...
  TWILIO_AUTH_TOKEN=...
  TWILIO_WHATSAPP_NUMBER=+14155238886 âœ“


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ§ª PASO 7: PROBAR EL BOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Abre WhatsApp en tu telÃ©fono

2. EnvÃ­a cualquier mensaje al sandbox de Twilio:
   "Hola"

3. Si todo estÃ¡ bien, el bot debe responder:
   
   "Â¡Bienvenido al sistema de citas mÃ©dicas! ğŸ¥
   
    Selecciona un mÃ©dico escribiendo el nÃºmero:
    
    1. Dr. Juan PÃ©rez - Medicina General
    2. Dra. MarÃ­a GonzÃ¡lez - PediatrÃ­a
    
    ğŸ’¡ Escribe "nueva cita" en cualquier momento para empezar de nuevo."

4. En la terminal del servidor deberÃ­as ver logs:
   POST /api/webhook/twilio-supabase 200 in Xms


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ SOLUCIÃ“N DE PROBLEMAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA 1: Bot no responde
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Verifica que ambas terminales estÃ©n corriendo
âœ“ Verifica que la URL en Twilio sea correcta
âœ“ Revisa la terminal del servidor por errores
âœ“ Verifica que .env tenga todas las variables

PROBLEMA 2: Error "No hay mÃ©dicos disponibles"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Ve a http://localhost:3000/schedules-new
âœ“ Crea al menos un mÃ©dico
âœ“ Crea horarios para ese mÃ©dico
âœ“ Genera slots de tiempo

PROBLEMA 3: ngrok "command not found"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Reinstala ngrok
âœ“ Verifica que estÃ© en el PATH
âœ“ Reinicia la terminal

PROBLEMA 4: "Este horario ya no estÃ¡ disponible"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Ve a la base de datos en Supabase
âœ“ Verifica que haya time_slots con is_available = true
âœ“ Regenera slots si es necesario

PROBLEMA 5: Twilio "11200 HTTP retrieval failure"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Verifica que ngrok estÃ© corriendo
âœ“ Verifica que el servidor Next.js estÃ© corriendo
âœ“ Revisa que la URL en Twilio sea exactamente la de ngrok


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”„ COMANDOS RÃPIDOS (RESUMEN)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Terminal 1 (Servidor):
  cd c:\Users\walte\CascadeProjects\windsurf-project\medicbot
  npm run dev

Terminal 2 (ngrok):
  ngrok http 3000

Twilio Webhook:
  https://TU-URL-DE-NGROK.ngrok.io/api/webhook/twilio-supabase


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¡ CONSEJOS IMPORTANTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Plan Gratuito de ngrok:
   - La URL cambia cada vez que lo reinicias
   - TendrÃ¡s que actualizar el webhook en Twilio cada vez
   - Considera el plan de paga ($8/mes) para URL fija

2. Para ProducciÃ³n:
   - Despliega tu aplicaciÃ³n en Vercel/Netlify/Railway
   - Usa la URL de producciÃ³n en Twilio
   - Ya no necesitas ngrok

3. Seguridad:
   - No compartas tu URL de ngrok pÃºblicamente
   - Valida los requests de Twilio con el validateRequest()
   - Usa variables de entorno (.env) para credenciales

4. Desarrollo:
   - MantÃ©n ambas terminales abiertas mientras desarrollas
   - Revisa los logs en la terminal del servidor
   - Usa console.log() para debugging


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… CHECKLIST FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Antes de probar, verifica:

[ ] npm install ejecutado
[ ] .env configurado con todas las variables
[ ] Schema SQL ejecutado en Supabase
[ ] Al menos 1 doctor creado en el sistema
[ ] Horarios creados para ese doctor
[ ] Slots generados
[ ] Terminal 1: npm run dev corriendo
[ ] Terminal 2: ngrok http 3000 corriendo
[ ] URL de ngrok copiada
[ ] Webhook configurado en Twilio Console
[ ] Enviado mensaje de prueba desde WhatsApp
[ ] Bot responde con lista de mÃ©dicos

Si todos los checks estÃ¡n âœ“, Â¡tu bot estÃ¡ funcionando! ğŸ‰


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ EJEMPLO DE CONVERSACIÃ“N COMPLETA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario: Hola
Bot: Â¡Bienvenido! Selecciona un mÃ©dico:
     1. Dr. Juan PÃ©rez
     2. Dra. MarÃ­a GonzÃ¡lez

Usuario: 1
Bot: Has seleccionado a Dr. Juan PÃ©rez
     Selecciona una fecha:
     1. Hoy (06/11/2024)
     2. MaÃ±ana (07/11/2024)

Usuario: 2
Bot: Horarios disponibles:
     1. 09:00 - 09:30
     2. 09:30 - 10:00

Usuario: 1
Bot: Has seleccionado:
     ğŸ‘¨â€âš•ï¸ MÃ©dico: Dr. Juan PÃ©rez
     ğŸ“… Fecha: 07/11/2024
     ğŸ• Hora: 09:00 - 09:30
     
     Escribe tu nombre completo:

Usuario: Juan GarcÃ­a
Bot: âœ… Â¡Cita confirmada exitosamente!
     Nombre: Juan GarcÃ­a
     CÃ³digo: ABC12345
     Â¡Gracias!


Â¡LISTO PARA USAR! ğŸš€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
